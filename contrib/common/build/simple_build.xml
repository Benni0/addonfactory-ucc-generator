<?xml version="1.0"?>

<project name="make_app" default="build">

	<!-- Define the following properties in a build.properties file that is in the same directory where you will run ant:
		
		     package.output.filename = The name of the archive that should be created 
		     files.input.dir = The location of the files to build the archive from
		     
		 Below is an example build.properties file:
		 
		     package.output.filename=MAXMIND
             files.input.dir=MAXMIND
	 -->
	
	<property file="${basedir}/local.build.properties"/>
	<property file="${basedir}/build.properties"/>

	<!-- ==================================================================
         Package an installable archive for the app                                                 
         ================================================================== -->
	<target name="build" description="Create the package for the app (excluding those pesky junk files)">
		
		<!-- Tar up the results -->
		<tar destfile="${package.output.filename}.tar" compression="none">
			<tarfileset dir="${files.input.dir}" prefix="${package.output.filename}">
				<exclude name="**/._**"/>
				<exclude name="**/thumbs.db"/>
				<exclude name="**/.DS_Store"/>
				<exclude name="**/build.xml"/>
				<exclude name="**/build.properties"/>
				<exclude name="**/local.build.properties"/>
			</tarfileset>
		</tar>

		<!-- Compress the archive -->
		<gzip destfile="${package.output.filename}.tar.gz" src="${package.output.filename}.tar"/>

		<!-- Delete the intermediate archive -->
		<delete file="${package.output.filename}.tar" />
	  	
	  	<!-- Move the file to the output directroy if the user defined one -->
	  	<antcall target="move_file_to_output" />
		
	</target>

	<!-- ==================================================================
		 Determine if the user has defined a path that they want the output package to go to
		 ================================================================== -->
	<target name="check_output_path_defined">
		<condition property="output_path_defined">
			<isset property="package.output.directory"/>
	    </condition>
	</target>
		
    <!-- ==================================================================
	     Move the file to the output location if the user has defined one
	     ================================================================== -->
	<target name="move_file_to_output" depends="check_output_path_defined" if="output_path_defined">
	  	 <move file="${package.output.filename}.tar.gz" todir="${package.output.directory}"/>
	</target>

	
</project>

