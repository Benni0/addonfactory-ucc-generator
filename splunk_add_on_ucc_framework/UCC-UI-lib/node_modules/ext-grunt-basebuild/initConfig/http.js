/**
 * Created by pmalviya on 11/15/15.
 */
module.exports = function(grunt) {
    'use strict';

    return {
        compare_version_in_bower: {
            options: {
                url: 'http://repo.splunk.com/artifactory/api/storage/bower-solutions-local/appcommon/<%=buildinfo.name%>',
                json: true,
                callback: function(error, response, body) {
                    if (response.statusCode === 200) {
                        var currentVersion = grunt.file.readJSON('bower.json').version;
                        grunt.log.writeln("current version:" + currentVersion);
                        for (var i=0; i < body.children.length; i++) {
                            if (body.children[i].uri === grunt.config.process('/<%=buildinfo.name%>-' + currentVersion + '.tar.gz')) {
                                grunt.log.writeln("incremental update - still publish artifact and docs");
                                break;
                            }
                        }
                        grunt.log.writeln("version change detected, publishing artifacts and docs");
                        grunt.task.run(['shell:publish'])
                    } else {
                        console.log("no version change detected!");
                    }

                }
            }

        }
    };
};
